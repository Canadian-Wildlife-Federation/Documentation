
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CABD Features and Database Models &#8212; Canadian Aquatic Barriers Database 0.1 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom_cwf_book.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="../../_static/main.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CABD REST Services (API Endpoints)" href="docs_tech_arch_api.html" />
    <link rel="prev" title="Application Architecture" href="../docs_tech_arch.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/cwf_logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  CABD User Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs_user/docs_user_web_map.html">
   Web Mapping Interface
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../docs_user/docs_user_data_sources.html">
   Data Sources
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_user/docs_user_data_sources/docs_user_data_sources_csv_download.html">
     Feature Data Source Details Download
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs_user/docs_user_data_catalogue.html">
   Data Catalogue
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../docs_user/docs_user_submitted_updates.html">
   Submit Data Updates
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../docs_user/docs_user_engagement.html">
   Stakeholder Engagement
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_user/docs_user_engagement/docs_user_engagement_use_cases.html">
     Use Cases
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  CABD Technical Documents
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../docs_tech_arch.html">
   Application Architecture
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     CABD Features and Database Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="docs_tech_arch_api.html">
     CABD REST Services (API Endpoints)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="docs_tech_arch_data_dict.html">
     Data Dictionary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="docs_tech_arch_tiles.html">
     Vector Tile Service
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../docs_tech_process.html">
   Barrier Data Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../docs_tech_process/docs_tech_process_dams.html">
     Feature Review Process
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  CHyF Documents
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../docs_chyf/docs_chyf_tools.html">
   CHyF Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_tools/docs_chyf_tools_copyright_author.html">
     CHyF Tools Copyright and Authorship
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_tools/docs_chyf_tools_logical_model.html">
     Logical Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_tools/docs_chyf_tools_data_model.html">
     Data Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_tools/docs_chyf_tools_flowpaths.html">
     Flowpath Constructor
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_tools/docs_chyf_tools_catchments.html">
     Catchment Delineator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_tools/docs_chyf_tools_specification.html">
     Input Specifications
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_tools/docs_chyf_tools_stream_order.html">
     Stream Order
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../docs_chyf/docs_chyf_process.html">
   Hydro Network Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_process/docs_chyf_process_steps.html">
     NHN - CHyF Conversion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_process/docs_chyf_process_stream_order.html">
     Calculating Stream Order
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../docs_chyf/docs_chyf_process/docs_chyf_process_troubleshoot.html">
     Troubleshooting
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <p></p>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/docs_tech/docs_tech_arch/docs_tech_arch_models.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/Canadian-Wildlife-Federation"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/Canadian-Wildlife-Federation/issues/new?title=Issue%20on%20page%20%2Fdocs_tech/docs_tech_arch/docs_tech_arch_models.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/github.com/Canadian-Wildlife-Federation/edit/master/docs_tech/docs_tech_arch/docs_tech_arch_models.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Document Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cabd-feature-model">
   CABD Feature Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generic-feature-model">
     Generic Feature Model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implemented-feature-model">
     Implemented Feature Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cabd-database-model">
   CABD Database Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#views">
     Views
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#core-tables">
     Core Tables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#shared-attribute-tables">
     Shared Attribute Tables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-tables">
     Feature Tables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-type-attribute-data-sources">
     Feature Type Attribute Data Sources
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-add-a-new-feature-type">
   How Add a New Feature Type
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="cabd-features-and-database-models">
<span id="cabd-models"></span><h1>CABD Features and Database Models<a class="headerlink" href="#cabd-features-and-database-models" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cabd-feature-model">
<span id="id1"></span><h2>CABD Feature Model<a class="headerlink" href="#cabd-feature-model" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<div class="section" id="generic-feature-model">
<span id="id2"></span><h3>Generic Feature Model<a class="headerlink" href="#generic-feature-model" title="Permalink to this headline">¶</a></h3>
<p>Features in CABD have an optional hierarchical structure. Feature types can be combined to form “super feature types”.</p>
<p>There are no structures in the software/database that enforce this model. The database views (see section below) are used to define the various feature types and super types. It would be possible for a feature type to be associated with multiple super types, if desired.</p>
<img alt="../../_images/generic-feature-model.png" class="align-center" src="../../_images/generic-feature-model.png" />
</div>
<div class="section" id="implemented-feature-model">
<span id="id3"></span><h3>Implemented Feature Model<a class="headerlink" href="#implemented-feature-model" title="Permalink to this headline">¶</a></h3>
<p>There are currently three feature types and one super type implemented in CABD. Adding additional feature types is expected and the instructions for this are outlined below (How to add new Feature Type).</p>
<img alt="../../_images/implemented-feature-model.png" class="align-center" src="../../_images/implemented-feature-model.png" />
<p>Feature types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">barriers</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dams</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">waterfalls</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fishways</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">medium</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">big</span></code></p></li>
</ul>
</div>
</div>
<div class="section" id="cabd-database-model">
<span id="id4"></span><h2>CABD Database Model<a class="headerlink" href="#cabd-database-model" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>The database is structured into multiple schemas.  Each feature type has its own schema, with a common <code class="docutils literal notranslate"><span class="pre">cabd</span></code> schema for shared data and feature metadata.</p>
<div class="section" id="views">
<span id="cabd-views"></span><h3>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h3>
<p>Each feature type and super feature type has an associated view which supports the api. This view should include all fields required for output (either for display on the UI or to support the future editing api).  The view <code class="docutils literal notranslate"><span class="pre">cabd.all_features_view</span></code> supports all features api endpoint.</p>
<p>The views are used to support the CABD APIs that list features. Each feature type is linked to a database view. When requesting features of a specific type the view associated with this type is queried. The fields returned by this view populate the attributes of the feature returned by the API. Feature type views will generally query a single data table (for example, the <code class="docutils literal notranslate"><span class="pre">dams</span></code> view queries the dams data table). Super feature types will generally query multiple data tables (for example, the <code class="docutils literal notranslate"><span class="pre">barriers</span></code> view queries both the dams data table and the waterfalls data table).</p>
</div>
<div class="section" id="core-tables">
<span id="id5"></span><h3>Core Tables<a class="headerlink" href="#core-tables" title="Permalink to this headline">¶</a></h3>
<p>These tables are the core tables for the system and required regardless of the feature types loaded. They support the definition of feature types.</p>
<p><code class="docutils literal notranslate"><span class="pre">cabd.feature_types</span></code></p>
<p>Lists all the feature types supported by the system.</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>type</p></td>
<td><p>Unique identifier for feature type. Required.</p></td>
</tr>
<tr class="row-odd"><td><p>data_view</p></td>
<td><p>The data view supporting the feature type. Required.</p></td>
</tr>
<tr class="row-even"><td><p>name</p></td>
<td><p>The human readable name for the feature type. Required.</p></td>
</tr>
<tr class="row-odd"><td><p>attribute_source_table</p></td>
<td><p>The data table containing the attribute data source information for the feature type. This is optional and can be null.</p></td>
</tr>
<tr class="row-even"><td><p>default_featurename_field</p></td>
<td><p>The field in the data_view that represents the main feature name.</p></td>
</tr>
<tr class="row-odd"><td><p>feature_source_table</p></td>
<td><p>The data table containing a link between the features and the data source information. This is optional and can be null.</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">cabd.feature_type_metadata</span></code></p>
<p>Lists all the attributes for a given feature view and the metadata details about the attribute.</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>view_name</p></td>
<td><p>The data view name.</p></td>
</tr>
<tr class="row-odd"><td><p>field_name</p></td>
<td><p>The field name in the data view that represents this attribute.</p></td>
</tr>
<tr class="row-even"><td><p>name</p></td>
<td><p>The name of the attribute.</p></td>
</tr>
<tr class="row-odd"><td><p>description</p></td>
<td><p>A description of the attribute.</p></td>
</tr>
<tr class="row-even"><td><p>is_link</p></td>
<td><p>Boolean.  If true this attribute will be treated as a URL in the API. The value will be returned in URL format (For example: link to another feature).</p></td>
</tr>
<tr class="row-odd"><td><p>data_type</p></td>
<td><p>The data type for the attribute. Valid values: varchar(xxx), text, boolean, array(type), integer, double, uuid, date, geometry.</p></td>
</tr>
<tr class="row-even"><td><p>vw_simple_order</p></td>
<td><p>Metadata for the UI. The UI supports a simple and all attribute view. This field represents the order the attribute should appear in the simple ui view. The value should be null for attributes that should not appear in the simple view.</p></td>
</tr>
<tr class="row-odd"><td><p>vw_all_order</p></td>
<td><p>Metadata for the UI. The UI supports a simple and all attribute view. This field represents the order the attribute should appear in the all attribute view. Should be null for attributes that should not appear in the view.</p></td>
</tr>
<tr class="row-even"><td><p>include_vector_tile</p></td>
<td><p>Boolean.  If true this attribute will be included in the vector tile service.</p></td>
</tr>
<tr class="row-odd"><td><p>value_options_reference</p></td>
<td><p>For columns that have a defined list of valid values in another database table (for example: <code class="docutils literal notranslate"><span class="pre">province_territory_code</span></code>), this field identifies what table the values can be loaded from and what fields in the table that provide the value, name, and description. This column should be null for fields that don’t reference tables.</p>
<p>The string should be of the form <code class="docutils literal notranslate"><span class="pre">“&lt;tablename&gt;;&lt;valuefield&gt;;&lt;namefield&gt;;&lt;descriptionfield&gt;”</span></code>. All are required except <code class="docutils literal notranslate"><span class="pre">descriptionfield</span></code> which can be blank.  The <code class="docutils literal notranslate"><span class="pre">tablename</span></code> references the code table, the <code class="docutils literal notranslate"><span class="pre">valuefield</span></code> the value field in the code table, the <code class="docutils literal notranslate"><span class="pre">namefield</span></code> the human friendly name field in the table, and <code class="docutils literal notranslate"><span class="pre">descriptionfield</span></code> the description field in the table.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">“dams.use_codes;code;name;description”</span></code> or <code class="docutils literal notranslate"><span class="pre">“cabd.province_territory_codes;code;name;”</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">cabd.data_source</span></code></p>
<p>Lists data sources. Supports data source tracking for feature type attributes.</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>id</p></td>
<td><p>A unique identifier for the data source.</p></td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>Name of the data source.</p></td>
</tr>
<tr class="row-even"><td><p>version_date</p></td>
<td><p>Data source version date.</p></td>
</tr>
<tr class="row-odd"><td><p>version_number</p></td>
<td><p>Data source version number (optional).</p></td>
</tr>
<tr class="row-even"><td><p>source</p></td>
<td><p>A link to the source data or description of where the source data came from.</p></td>
</tr>
<tr class="row-odd"><td><p>comments</p></td>
<td><p>Any additional comments.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="shared-attribute-tables">
<span id="id6"></span><h3>Shared Attribute Tables<a class="headerlink" href="#shared-attribute-tables" title="Permalink to this headline">¶</a></h3>
<p>All of these tables store data that are shared between multiple feature types. Generally, each of these tables have a unique code (for references), a name, and a description.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cabd.barrier_ownership_type_codes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cabd.fish_species</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cabd.nhn_workunit</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cabd.passability_status_codes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cabd.province_territory_codes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cabd.upstream_passage_type_codes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cabd.census_subdivisions</span></code></p></li>
</ul>
</div>
<div class="section" id="feature-tables">
<span id="id7"></span><h3>Feature Tables<a class="headerlink" href="#feature-tables" title="Permalink to this headline">¶</a></h3>
<p>The feature type data tables are found in their corresponding schema. Generally, there will be one feature data table and a number of reference tables that represent attribute values.  Details for current feature types can be found in the Data Dictionary document.</p>
</div>
<div class="section" id="feature-type-attribute-data-sources">
<span id="id8"></span><h3>Feature Type Attribute Data Sources<a class="headerlink" href="#feature-type-attribute-data-sources" title="Permalink to this headline">¶</a></h3>
<p>The CABD database has the option of storing the data source for each attribute associated with the feature type. This has been implemented by having <code class="docutils literal notranslate"><span class="pre">&lt;featuretype&gt;.&lt;featuretype&gt;_feature_source</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;featuretype&gt;.&lt;featuretype&gt;_attribute_source</span></code> tables for the feature type.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;featuretype&gt;_feature_source</span></code>  table contains for each cabd feature a link to the data source and associated data source feature id.</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Column</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cabd_id</p></td>
<td><p>The unique cabd feature identifier. This id must exist in the corresponding data table for the feature type.</p></td>
</tr>
<tr class="row-odd"><td><p>datasource_id</p></td>
<td><p>A link to the data source id in the cabd.data_source table</p></td>
</tr>
<tr class="row-even"><td><p>datasource_feature_id</p></td>
<td><p>The identifier of the feature in the data source.</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;featuretype&gt;_attribute_source</span></code> table contains the cabd_id and one column for each attribute that requires data source tracking.  The column, <code class="docutils literal notranslate"><span class="pre">&lt;attribute&gt;_ds</span></code>, links to the <code class="docutils literal notranslate"><span class="pre">cabd.data_source</span> <span class="pre">table</span></code> to identify the data source for the attribute value.</p>
</div>
</div>
<div class="section" id="how-add-a-new-feature-type">
<span id="add-new-feature-type"></span><h2>How Add a New Feature Type<a class="headerlink" href="#how-add-a-new-feature-type" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>New feature types can be added to the system by adding the data to the database and updating the database metadata tables.</p>
<ol class="arabic simple">
<li><p>Create a new schema for your feature type.</p></li>
<li><p>Create the required data tables and reference tables to store the feature data and populate these tables. These should exist in their own <code class="docutils literal notranslate"><span class="pre">&lt;featuretype&gt;</span></code> schema.</p></li>
<li><p>Create a view that joins the data table with the reference tables to include all the data you want visible to the ui.  Use one of the existing feature types views as an example (ex. <code class="docutils literal notranslate"><span class="pre">cabd.dams_view</span></code>).</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When creating and/or updating existing view the role cabd must have permission to use the view (otherise the application won’t start up).</p>
<p><code class="docutils literal notranslate"><span class="pre">GRANT</span> <span class="pre">ALL</span> <span class="pre">PRIVILEGES</span> <span class="pre">ON</span> <span class="pre">cabd.dams_view</span> <span class="pre">to</span> <span class="pre">cabd;</span></code></p>
</div>
<ol class="arabic simple" start="4">
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">cabd.all_features_view</span></code> to include the data from this new feature type. Use the existing view as an example, appending the new feature type data.</p></li>
<li><p>If the new feature type is considered a barrier you also need to update the <code class="docutils literal notranslate"><span class="pre">cabd.barriers_view</span></code>.  Use the existing view as an example.</p></li>
<li><p>Add a row to the <code class="docutils literal notranslate"><span class="pre">cabd.feature_types</span></code> table to represent the new feature type.</p></li>
<li><dl class="simple">
<dt>Add rows to the <code class="docutils literal notranslate"><span class="pre">cabd.feature_type_metadata</span> <span class="pre">table</span></code>. One row needs to be added for each column returned by the feature type view created in step 3.</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">view_name</span></code> – the name of the view created in step3</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">field_name</span></code> – the name of the field in the view</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> – the human friendly name for the column</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code> – (optional) a description for the column</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_link</span></code> – true if the column represents a link to another api end point in the application</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_type</span></code> – data type of the column</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vw_simple_order</span></code> – the order the column should appear in the simple view of the feature (or null if it shouldn’t appear at all in the simple view)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vw_all_order</span></code> – the order the column should appear in the all info view of the feature (or null if it shouldn’t appear at all)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include_vector_tile</span></code> – true or false if the attribute should be included in the vector tile of this feature type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value_options_reference</span></code> – for columns that have a defined list of valid values in another database table (for example: <code class="docutils literal notranslate"><span class="pre">province_territory_code</span></code>), this field identifies what table the values can be loaded from and what fields in the table that provide the value, name, and description. This column should be null for fields that don’t reference tables; otherwise it should contain a string of the form <code class="docutils literal notranslate"><span class="pre">“&lt;tablename&gt;;&lt;valuefield&gt;;&lt;namefield&gt;;&lt;descriptionfield&gt;”</span></code>. All are required except <code class="docutils literal notranslate"><span class="pre">descriptionfield</span></code> which can be blank.  The <code class="docutils literal notranslate"><span class="pre">tablename</span></code> references the code table, the <code class="docutils literal notranslate"><span class="pre">valuefield</span></code> the value field in the code table, the <code class="docutils literal notranslate"><span class="pre">namefield</span></code> the human friendly name field in the table, and <code class="docutils literal notranslate"><span class="pre">descriptionfield</span></code> the description field in the table.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>[OPTIONAL] Create the <code class="docutils literal notranslate"><span class="pre">&lt;featuretype&gt;.&lt;featuretype&gt;_feature_source</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;featuretype&gt;.&lt;featuretype&gt;_attribute_source</span> <span class="pre">tables</span></code> and populate with appropriate data.</p></li>
<li><p>Restart the web server.  A restart is required to reload the cached metadata.</p></li>
<li><p>At this point the features should be available in the API.</p></li>
</ol>
<p>The new feature type should show up in the types API: <code class="docutils literal notranslate"><span class="pre">https://server.ca/cabd-api/features/types/</span></code>.</p>
<p>The new features can be accessed from here: <code class="docutils literal notranslate"><span class="pre">https://server.ca/cabd-api/features/&lt;newfeaturetype&gt;</span></code>.</p>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../docs_tech_arch.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Application Architecture</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="docs_tech_arch_api.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CABD REST Services (API Endpoints)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
            &copy; Copyright 2022, Canadian Wildlife Federation.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>