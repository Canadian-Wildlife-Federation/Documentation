==========
Data Model
==========

This document is designed to describe the target data model for CHyF.  For reference (at the end) it includes a description of the existing CHyF services data model, and the data model output from the CHyF processing tools.

CHyF Application Data Model
---------------------------

-----

This is intended to represent the proposed logical model.  Additional fields and/or tables may be needed to support hierarchical queries; these will be documented separately and will not affect what attributes are available to the user. 

.. csv-table:: **Data Types**
    :file: tbl/chyfdatatypes.csv
    :widths: 25, 75
    :header-rows: 1

.. csv-table:: **EFlowpath**
    :file: tbl/eflowpath.csv
    :widths: 20, 20, 20, 40
    :header-rows: 1

EFlowpath Attributes
~~~~~~~~~~~~~~~~~~~~

We propose to add an attributes table for storing any flowpath attributes that are not in the source dataset and/or are derived by the system or additional tools.  Columns could be added dynamically as the tools/scripts are built to compute the attributes.  The CHyF API flowpath schema would be dynamic based on the columns in this table (or alternatively we could have a simple schema that is fixed and a full schema which is dynamic).  

We could include these in the eflowpath table, however it would make this table larger. For performance purposes it would be best to keep this table small and generally only include attributes required for network traversal.

.. csv-table:: **EFlowpath Attributes**
    :file: tbl/eflowpathattr.csv
    :widths: 25, 20, 15, 40
    :header-rows: 1

.. csv-table:: **Attribute: ef_type**
    :file: tbl/ef_type.csv
    :widths: 5, 25, 70

.. csv-table:: **Attribute: ef_subtype**
    :file: tbl/ef_subtype.csv
    :widths: 5, 25, 70

Nexus
~~~~~

The features in this table will be generated by the system loading process. Users are not required to provide this dataset. 

.. csv-table:: **Nexus**
    :file: tbl/nexus.csv
    :widths: 25, 20, 15, 50
    :header-rows: 1

.. csv-table:: **Attribute: nexus_type**
    :file: tbl/nexus_type.csv
    :widths: 5, 20, 75

ECatchment
~~~~~~~~~~

.. csv-table:: **ECatchment**
    :file: tbl/ecatchment.csv
    :widths: 20, 10, 15, 55
    :header-rows: 1

.. csv-table:: **Attribute: ec_type**
    :file: tbl/ec_type.csv
    :widths: 5, 20, 75

.. csv-table:: **Attribute: ec_subtype**
    :file: tbl/subtype.csv
    :widths: 5, 20, 75

.. csv-table:: **ECatchment Attributes**
    :file: tbl/ecatchmentattr.csv
    :widths: 20, 10, 15, 55
    :header-rows: 1

.. csv-table:: **AOI**
    :file: tbl/aoi.csv
    :widths: 20, 10, 15, 55
    :header-rows: 1

.. csv-table:: **Shoreline**
    :file: tbl/shoreline.csv
    :widths: 20, 10, 15, 55
    :header-rows: 1


Terminal Node
~~~~~~~~~~~~~~

*These are not required or used by any of the services, but are included here as they will help with data updates/integrations between AOIs.*

.. csv-table:: **Terminal Node**
    :file: tbl/terminalpoint.csv
    :widths: 20, 10, 15, 55
    :header-rows: 1

Names
~~~~~

.. csv-table:: **Names**
    :file: tbl/names.csv
    :widths: 15, 10, 15, 60
    :header-rows: 1

CHyF Tools Output Data Model
----------------------------

-----

This is the data model outputted after running the CHyF processing tools (skeletonizer, directionalizer, rank definition & catchment generator). If the catchment generator is not run, the output is the same but the catchments are not populated.

The output will include the following datasets: 

.. csv-table:: **Output Datasets**
    :file: tbl/chyfdatasets.csv
    :widths: 30, 70
    :header-rows: 1

The following outputs are also included as they are required as part of the processing but are not of interest for the end CHyF product: 

* Construction Points 

* Processing Blocks 

* Hydro Edges 

* Catchment Construction Edges 

.. csv-table:: **EFlowpaths**
    :file: tbl/eflowoutput.csv
    :widths: 25, 10, 65
    :header-rows: 1

.. csv-table:: **ECatchments**
    :file: tbl/ecatchoutput.csv
    :widths: 25, 10, 65
    :header-rows: 1

.. csv-table:: **AOI**
    :file: tbl/aoioutput.csv
    :widths: 25, 10, 65
    :header-rows: 1

.. csv-table:: **Terminal Nodes**
    :file: tbl/termnodeoutput.csv
    :widths: 25, 10, 65
    :header-rows: 1

.. csv-table:: **Shorelines**
    :file: tbl/shorelineoutput.csv
    :widths: 25, 10, 65
    :header-rows: 1
    